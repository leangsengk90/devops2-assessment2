┌─────────────────────────────────────────────────────────────────────────────┐
│                        Internet / External Clients                           │
└────────────────────────────────────┬────────────────────────────────────────┘
                                     │
                                     │ HTTPS
                                     │
┌────────────────────────────────────▼────────────────────────────────────────┐
│                     AWS API Gateway (Shared - HTTP API)                      │
│              https://xxxxx.execute-api.us-east-1.amazonaws.com              │
│                                                                               │
│  Routes (Path-based routing):                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  ANY /api1/{proxy+}      → VPC Link → api1 ALB                      │    │
│  │  ANY /auth/{proxy+}      → VPC Link → auth ALB                      │    │
│  │  ANY /profile/{proxy+}   → VPC Link → profile ALB                   │    │
│  │  ANY /messenger/{proxy+} → VPC Link → messenger ALB                 │    │
│  │  ANY /finance/{proxy+}   → VPC Link → finance ALB                   │    │
│  │  ANY /share/{proxy+}     → VPC Link → share ALB                     │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                               │
│  Stage: $default (auto-deploy)                                               │
│  CORS: Enabled (allow all origins)                                           │
│  Throttling: 5000 burst, 10000/sec rate                                      │
└────────────────────────────────────┬────────────────────────────────────────┘
                                     │
                                     │
┌────────────────────────────────────▼────────────────────────────────────────┐
│                          VPC Link (Shared)                                   │
│                   (Connects API Gateway to Private VPC)                      │
│                    Security Group: vpc-link-sg                               │
└────────────────────────────────────┬────────────────────────────────────────┘
                                     │
                                     │
    ┌────────────────────────────────┼────────────────────────────────┐
    │                          VPC (10.0.0.0/16)                       │
    │                                                                   │
    │  ┌────────────────────────────────────────────────────────────┐ │
    │  │              Private Subnets (Multiple AZs)                 │ │
    │  │                                                              │ │
    │  │  ┌──────────────────────────────────────────────────────┐  │ │
    │  │  │ SERVICE: API1                                         │  │ │
    │  │  │ ────────────────────────────────────────────────────  │  │ │
    │  │  │ ALB (internal) :80                                    │  │ │
    │  │  │        ↓                                              │  │ │
    │  │  │ Target Group :80                                      │  │ │
    │  │  │        ↓                                              │  │ │
    │  │  │ ECS Cluster: devops2-g4-api1-cluster-prod            │  │ │
    │  │  │   ECS Service (Fargate): 2-10 tasks                  │  │ │
    │  │  │   Container: nginx:alpine :80                        │  │ │
    │  │  │   Auto-scale: CPU/Memory 30%-70%                     │  │ │
    │  │  │   Container Insights: Enabled                        │  │ │
    │  │  └──────────────────────────────────────────────────────┘  │ │
    │  │                                                              │ │
    │  │  ┌──────────────────────────────────────────────────────┐  │ │
    │  │  │ SERVICE: AUTH                                         │  │ │
    │  │  │ ────────────────────────────────────────────────────  │  │ │
    │  │  │ ALB (internal) :80                                    │  │ │
    │  │  │        ↓                                              │  │ │
    │  │  │ Target Group :3000                                    │  │ │
    │  │  │        ↓                                              │  │ │
    │  │  │ ECS Cluster: devops2-g4-auth-cluster-prod            │  │ │
    │  │  │   ECS Service (Fargate): 2-10 tasks                  │  │ │
    │  │  │   Container: auth-app :3000                          │  │ │
    │  │  │   Auto-scale: CPU/Memory 30%-70%                     │  │ │
    │  │  └──────────────────────────────────────────────────────┘  │ │
    │  │                                                              │ │
    │  │  ┌──────────────────────────────────────────────────────┐  │ │
    │  │  │ SERVICE: PROFILE                                      │  │ │
    │  │  │ ────────────────────────────────────────────────────  │  │ │
    │  │  │ ALB (internal) :80                                    │  │ │
    │  │  │        ↓                                              │  │ │
    │  │  │ Target Group :3001                                    │  │ │
    │  │  │        ↓                                              │  │ │
    │  │  │ ECS Cluster: devops2-g4-profile-cluster-prod         │  │ │
    │  │  │   ECS Service (Fargate): 2-10 tasks                  │  │ │
    │  │  │   Container: profile-app :3001                       │  │ │
    │  │  │   Auto-scale: CPU/Memory 30%-70%                     │  │ │
    │  │  └──────────────────────────────────────────────────────┘  │ │
    │  │                                                              │ │
    │  │  ┌──────────────────────────────────────────────────────┐  │ │
    │  │  │ SERVICE: MESSENGER                                    │  │ │
    │  │  │ ────────────────────────────────────────────────────  │  │ │
    │  │  │ ALB (internal) :80                                    │  │ │
    │  │  │        ↓                                              │  │ │
    │  │  │ Target Group :3002                                    │  │ │
    │  │  │        ↓                                              │  │ │
    │  │  │ ECS Cluster: devops2-g4-messenger-cluster-prod       │  │ │
    │  │  │   ECS Service (Fargate): 2-10 tasks                  │  │ │
    │  │  │   Container: messenger-app :3002                     │  │ │
    │  │  │   Auto-scale: CPU/Memory 30%-70%                     │  │ │
    │  │  └──────────────────────────────────────────────────────┘  │ │
    │  │                                                              │ │
    │  │  ┌──────────────────────────────────────────────────────┐  │ │
    │  │  │ SERVICE: FINANCE                                      │  │ │
    │  │  │ ────────────────────────────────────────────────────  │  │ │
    │  │  │ ALB (internal) :80                                    │  │ │
    │  │  │        ↓                                              │  │ │
    │  │  │ Target Group :8080                                    │  │ │
    │  │  │        ↓                                              │  │ │
    │  │  │ ECS Cluster: devops2-g4-finance-cluster-prod         │  │ │
    │  │  │   ECS Service (Fargate): 2-10 tasks                  │  │ │
    │  │  │   Container: finance-app :8080                       │  │ │
    │  │  │   Auto-scale: CPU/Memory 30%-70%                     │  │ │
    │  │  └──────────────────────────────────────────────────────┘  │ │
    │  │                                                              │ │
    │  │  ┌──────────────────────────────────────────────────────┐  │ │
    │  │  │ SERVICE: SHARE                                        │  │ │
    │  │  │ ────────────────────────────────────────────────────  │  │ │
    │  │  │ ALB (internal) :80                                    │  │ │
    │  │  │        ↓                                              │  │ │
    │  │  │ Target Group :3004                                    │  │ │
    │  │  │        ↓                                              │  │ │
    │  │  │ ECS Cluster: devops2-g4-share-cluster-prod           │  │ │
    │  │  │   ECS Service (Fargate): 2-10 tasks                  │  │ │
    │  │  │   Container: share-app :3004                         │  │ │
    │  │  │   Auto-scale: CPU/Memory 30%-70%                     │  │ │
    │  │  └──────────────────────────────────────────────────────┘  │ │
    │  │                                                              │ │
    │  └──────────────────────────────────────────────────────────┘ │
    │                                                                 │
    │  ┌──────────────────────────────────────────────────────────┐ │
    │  │              Public Subnets (Multiple AZs)                │ │
    │  │                                                            │ │
    │  │  NAT Gateway (provides internet access for containers)    │ │
    │  │              ↓                                             │ │
    │  │       Internet Gateway                                     │ │
    │  └──────────────────────────────────────────────────────────┘ │
    └───────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────┐
│                        Supporting Infrastructure                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ECR Repositories (us-east-1):                                          │
│  ├─ 481604401489.dkr.ecr.us-east-1.amazonaws.com/devops2-g4-api1-prod  │
│  ├─ 481604401489.dkr.ecr.us-east-1.amazonaws.com/devops2-g4-auth-prod  │
│  ├─ 481604401489.dkr.ecr.us-east-1.amazonaws.com/devops2-g4-profile-prod│
│  ├─ 481604401489.dkr.ecr.us-east-1.amazonaws.com/devops2-g4-messenger-prod│
│  ├─ 481604401489.dkr.ecr.us-east-1.amazonaws.com/devops2-g4-finance-prod│
│  └─ 481604401489.dkr.ecr.us-east-1.amazonaws.com/devops2-g4-share-prod │
│      └─ Image scanning: Amazon Inspector (enabled)                     │
│                                                                          │
│  IAM Roles:                                                             │
│  ├─ ECS Task Execution Role (pull ECR images, write CloudWatch logs)   │
│  └─ ECS Task Role (application-level AWS permissions)                  │
│                                                                          │
│  CloudWatch:                                                            │
│  ├─ Log Groups:                                                         │
│  │  ├─ /aws/ecs/devops2-g4-app (shared ECS logs)                       │
│  │  ├─ /aws/apigateway/devops2-g4-main-prod (API Gateway logs)         │
│  │  └─ /aws/ecs/containerinsights/{cluster}/performance (per cluster)  │
│  │                                                                       │
│  └─ Alarms (per service):                                               │
│     ├─ CPU High (>70%) → Scale Up                                       │
│     ├─ CPU Low (<30%) → Scale Down                                      │
│     ├─ Memory High (>70%) → Scale Up                                    │
│     └─ Memory Low (<30%) → Scale Down                                   │
│                                                                          │
│  Security Groups:                                                       │
│  ├─ ALB Security Group: Allow traffic from VPC Link                    │
│  ├─ ECS Security Group: Allow traffic from ALB only                    │
│  └─ VPC Link Security Group: Allow HTTPS from anywhere                 │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘


Traffic Flow Example:
═══════════════════════════════════════════════════════════════════════════

Client Request:
  GET https://xxxxx.execute-api.us-east-1.amazonaws.com/finance/transactions

       ↓
   API Gateway
       ↓ (routes to /finance)
   VPC Link
       ↓
   Finance ALB :80
       ↓
   Finance Target Group :8080
       ↓
   Finance ECS Task (Container) :8080
       ↓
   Response returned through same path


Key Features:
═════════════════════════════════════════════════════════════════════════
✓ Single API Gateway with 6 service routes
✓ Path-based routing (/api1, /auth, /profile, /messenger, /finance, /share)
✓ Each service isolated with its own ALB, ECS cluster, and containers
✓ Auto-scaling: 2-10 tasks per service based on CPU/Memory
✓ Container Insights enabled for monitoring
✓ Private ALBs (not internet-facing)
✓ NAT Gateway for container internet access (pull images, external APIs)
✓ ECR image scanning with Amazon Inspector
✓ Centralized logging in CloudWatch
✓ High availability across multiple availability zones